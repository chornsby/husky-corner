<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="/husky-corner/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    <title>Husky Corner</title>
</head>
<body>
<nav class="navbar" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="/husky-corner/">
            <img src="/husky-corner/img/favicon.png" alt="Husky Corner"/>
        </a>
        <a class="navbar-item" href="/husky-corner/">
            Husky Corner
        </a>
        <a class="navbar-item" href="/husky-corner/convert/">
            Convert to Excel
        </a>
    </div>
</nav>
<section class="section">
    <div class="container">
        <h1 class="title">Upload a file</h1>
        <p>
            This utility converts a file of text separated with
            <code>&lt;</code> characters into separate columns in an Excel
            spreadsheet.
        </p>
        <br>
        <div class="field">
            <label class="label">Text file</label>
            <div class="file has-name is-fullwidth">
                <label class="file-label">
                    <input id="file-input" class="file-input" type="file" name="file">
                    <span class="file-cta">
                        <span class="file-label">Choose a file</span>
                    </span>
                    <span id="filename-span" class="file-name"></span>
                </label>
            </div>
        </div>
        <div class="field">
            <label class="label">Excel filename</label>
            <div class="control">
                <input id="filename-input" class="input" type="text" placeholder="Optional">
            </div>
        </div>
        <div class="field">
            <label class="label">Episode</label>
            <div class="control">
                <input id="episode-input" class="input" type="text" placeholder="Optional">
            </div>
        </div>
        <div class="field">
            <div class="control">
                <button id="download-button" class="button is-primary">
                    Download
                </button>
            </div>
        </div>
    </div>
</section>
<footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <strong>Husky Corner</strong> by
            <a href="https://gitlab.com/chornsby" target="_blank">chornsby</a>
        </div>
    </div>
</footer>
<script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.2/xlsx.full.min.js"></script>
<script type="module">
    import {downloadWorkbook, convertToWorkbook, readFileAsText} from '/husky-corner/js/utils.mjs';

    const downloadButton = document.querySelector("#download-button");
    const fileInput = document.querySelector("#file-input");
    const filenameSpan = document.querySelector("#filename-span");
    const filenameInput = document.querySelector("#filename-input");
    const episodeInput = document.querySelector("#episode-input");

    let inputContent = "";

    fileInput.onchange = async (event) => {
        const inputFile = event.target.files[0];
        filenameSpan.textContent = inputFile.name;
        inputContent = await readFileAsText(inputFile);
    };

    downloadButton.onclick = () => {
        try {
            const outputWorkbook = convertToWorkbook(inputContent, episodeInput.value);
            downloadWorkbook(outputWorkbook, filenameInput.value);
        } catch (e) {
            alert(e.message);
        }
    };
</script>
</body>
</html>
